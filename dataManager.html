<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®ç®¡ç†å·¥å…· - LinkBoard</title>
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* ç®¡ç†å·¥å…·ç‰¹æœ‰æ ·å¼ */
    .data-manager-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .data-manager-header {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }
    
    .data-manager-section {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }
    
    .data-manager-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .tab-btn {
      padding: 10px 20px;
      border: none;
      background: var(--bg-secondary);
      color: var(--text-primary);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .tab-btn.active {
      background: var(--primary-color);
      color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 14px;
      box-sizing: border-box;
    }
    
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    /* æ ‡é¢˜å±‚çº§ä¼˜åŒ– */
    .section-group-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--primary-color);
      margin: 25px 0 15px 0;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--primary-color);
    }
    
    .section-group-title:first-child {
      margin-top: 0;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }
    
    .btn-danger {
      background: #e74c3c;
      color: white;
    }
    
    .btn-success {
      background: #27ae60;
      color: white;
    }
    
    .btn:hover {
      opacity: 0.8;
      transform: translateY(-1px);
    }
    
    .data-list {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 10px;
      background: var(--bg-secondary);
    }

    /* é“¾æ¥ç®¡ç†é¡µé¢çš„ç°æœ‰é“¾æ¥å®¹å™¨é«˜åº¦è°ƒæ•´ */
    #links-tab .data-list {
      max-height: 800px;
    }
    
    .data-item {
      padding: 10px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .data-item:last-child {
      border-bottom: none;
    }
    
    .data-item-info {
      flex: 1;
    }
    
    .data-item-actions {
      display: flex;
      gap: 5px;
    }
    
    /* åˆ†ç±»é¢œè‰²å—æ ·å¼ */
    .category-color-block {
      display: inline-block;
      width: 16px;
      height: 16px;
      border-radius: 4px;
      margin-right: 8px;
      vertical-align: middle;
      border: 1px solid rgba(0,0,0,0.1);
    }
    
    .status-indicator {
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: bold;
      margin-top: 10px;
    }
    
    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .status-warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .json-editor {
      width: 100%;
      min-height: 300px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 10px;
      color: var(--text-primary);
      box-sizing: border-box;
    }

    .flex-container {
      display: flex;
      gap: 20px;
      position: relative;
    }
    
    .flex-container::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 1px;
      background: var(--border-color);
      transform: translateX(-50%);
      z-index: 1;
    }

    .flex-1 {
      flex: 1;
    }

    .code-preview {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      overflow-y: auto;
      margin: 10px 0;
      min-height: 300px;
    }
    
    /* ç”Ÿæˆæ–‡ä»¶é¡µé¢ç‰¹æ®Šå¸ƒå±€ */
    #export-tab.active {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 200px); /* å‡å»å¤´éƒ¨å’Œæ ‡ç­¾æ çš„é«˜åº¦ */
    }
    
    #export-tab.active .data-manager-section {
      display: flex;
      flex-direction: column;
      flex: 1;
      margin-bottom: 0;
    }
    
    #export-tab.active .flex-container {
      flex-shrink: 0;
    }
    
    #export-tab.active #codePreviewContainer {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-top: 20px;
    }
    
    #export-tab.active #codePreview {
      flex: 1;
      min-height: 200px;
      max-height: none;
    }

    /* ç½‘ç«™è®¾ç½®ç‰¹æœ‰æ ·å¼ */
    .setting-preview {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .preview-item {
      margin-bottom: 15px;
      padding: 10px;
      background: var(--card-bg);
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }

    .logo-preview {
      font-size: 18px;
      font-weight: bold;
      color: var(--primary-color);
      margin-top: 5px;
      padding: 8px;
      background: var(--bg-secondary);
      border-radius: 4px;
    }

    .page-title-preview {
      font-size: 14px;
      color: var(--text-primary);
      margin-top: 5px;
      font-style: italic;
      padding: 4px;
      background: var(--bg-secondary);
      border-radius: 4px;
    }

    .dashboard-preview {
      margin-top: 5px;
      padding: 8px;
      background: var(--bg-secondary);
      border-radius: 4px;
    }

    .dash-title {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-primary);
    }

    .dash-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 2px;
    }

    .form-group small {
      color: var(--text-secondary);
      font-size: 12px;
      margin-top: 3px;
      display: block;
    }

    .form-group input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }
    
    .form-group input[type="color"] {
      width: 60px;
      height: 40px;
      padding: 2px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: transparent;
      cursor: pointer;
    }

    /* æ ‡ç­¾é€‰æ‹©å™¨æ ·å¼ */
    .tag-item {
      display: inline-block;
      padding: 4px 8px;
      background: var(--primary-color);
      color: white;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }

    .tag-item:hover {
      background: var(--text-secondary);
      transform: translateY(-1px);
    }

    .tag-item.added {
      background: #27ae60;
    }

    @media (max-width: 768px) {
      .flex-container {
        flex-direction: column;
      }
      
      .data-manager-tabs {
        flex-wrap: wrap;
      }
      
      .tab-btn {
        flex: 1;
        min-width: 120px;
      }
    }
  </style>
</head>
<body>
  <div class="data-manager-container">
    <div class="data-manager-header">
      <h1>ğŸ› ï¸ æ•°æ®ç®¡ç†å·¥å…·</h1>
      <p>ç®¡ç†LinkBoardçš„åˆ†ç±»å’Œé“¾æ¥æ•°æ®</p>
      <div class="status-indicator status-success" id="statusIndicator">
        ç³»ç»Ÿå°±ç»ª
      </div>
    </div>

    <div class="data-manager-tabs">
      <button class="tab-btn active" data-tab="categories">åˆ†ç±»ç®¡ç†</button>
      <button class="tab-btn" data-tab="links">é“¾æ¥ç®¡ç†</button>
      <button class="tab-btn" data-tab="settings">ç½‘ç«™è®¾ç½®</button>
      <button class="tab-btn" data-tab="export">ç”Ÿæˆæ–‡ä»¶</button>
    </div>

    <!-- åˆ†ç±»ç®¡ç† -->
    <div class="tab-content active" id="categories-tab">
      <div class="data-manager-section">
        <h2>åˆ†ç±»ç®¡ç†</h2>
        <div class="flex-container">
          <div class="flex-1">
            <h3 class="section-group-title">æ·»åŠ /ç¼–è¾‘åˆ†ç±»</h3>
            <form id="categoryForm">
              <div class="form-group">
                <label>åˆ†ç±»ID</label>
                <input type="text" id="categoryId" placeholder="å¦‚ï¼šnew-category" required>
                <small>æ³¨æ„ï¼šIDä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå»ºè®®ä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦</small>
              </div>
              <div class="form-group">
                <label>åˆ†ç±»åç§°</label>
                <input type="text" id="categoryName" placeholder="å¦‚ï¼šæ–°åˆ†ç±»" required>
              </div>
              <div class="form-group">
                <label>å›¾æ ‡ (Emoji)</label>
                <input type="text" id="categoryIcon" placeholder="å¦‚ï¼šğŸ¯" required>
              </div>
              <div class="form-group">
                <label>é¢œè‰²</label>
                <input type="color" id="categoryColor" value="#3498db" required>
              </div>
              <div class="form-group">
                <label>æè¿°</label>
                <textarea id="categoryDescription" placeholder="åˆ†ç±»æè¿°"></textarea>
              </div>
              <button type="submit" class="btn btn-primary">ä¿å­˜åˆ†ç±»</button>
              <button type="button" class="btn btn-secondary" id="resetCategoryForm">é‡ç½®</button>
            </form>
          </div>
          <div class="flex-1">
            <h3 class="section-group-title">ç°æœ‰åˆ†ç±»</h3>
            <div class="data-list" id="categoriesList"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- é“¾æ¥ç®¡ç† -->
    <div class="tab-content" id="links-tab">
      <div class="data-manager-section">
        <h2>é“¾æ¥ç®¡ç†</h2>
        <div class="flex-container">
          <div class="flex-1">
            <h3 class="section-group-title">å›¾æ ‡è®¾ç½®è¯´æ˜</h3>
            <div class="setting-preview">
              <div class="preview-item">
                <strong>ğŸ“Œ å›¾æ ‡è®¾ç½®è§„åˆ™ï¼š</strong>
                <ul style="margin: 8px 0; padding-left: 20px;">
                  <li><strong>å›¾æ ‡URL</strong>ï¼šè¾“å…¥å®Œæ•´çš„å›¾æ ‡é“¾æ¥åœ°å€</li>
                  <li><strong>ç•™ç©ºé»˜è®¤</strong>ï¼šä¸å¡«å†™URLæ—¶è‡ªåŠ¨ä½¿ç”¨ ç½‘ç«™åŸŸå/favicon.ico</li>
                  <li><strong>æ”¯æŒæ ¼å¼</strong>ï¼š.icoã€.pngã€.jpgã€.svg</li>
                </ul>
              </div>
              <div class="preview-item">
                <strong>âš ï¸ æ³¨æ„äº‹é¡¹ï¼š</strong>
                <ul style="margin: 8px 0; padding-left: 20px;">
                  <li>åœ¨çº¿URLå¯èƒ½å­˜åœ¨åŠ è½½å¤±è´¥æˆ–è·¨åŸŸé—®é¢˜</li>
                  <li>å»ºè®®å›¾æ ‡å°ºå¯¸ï¼š16x16æˆ–32x32åƒç´ </li>
                  <li>ç¡®ä¿å›¾æ ‡URLç¨³å®šå¯è®¿é—®</li>
                </ul>
              </div>
            </div>
            
            <h3 class="section-group-title">æ·»åŠ /ç¼–è¾‘é“¾æ¥</h3>
            <form id="linkForm">
              <div class="form-group">
                <label>æ‰€å±åˆ†ç±»</label>
                <select id="linkCategory" required>
                  <option value="">é€‰æ‹©åˆ†ç±»</option>
                </select>
              </div>
              <div class="form-group">
                <label>é“¾æ¥æ ‡é¢˜</label>
                <input type="text" id="linkTitle" placeholder="å¦‚ï¼šGitHub" required>
              </div>
              <div class="form-group">
                <label>é“¾æ¥åœ°å€</label>
                <input type="url" id="linkUrl" placeholder="https://github.com" required>
              </div>
              <div class="form-group">
                <label>æè¿°</label>
                <textarea id="linkDescription" placeholder="é“¾æ¥æè¿°"></textarea>
              </div>
              <div class="form-group">
                <label>å›¾æ ‡URL</label>
                <input type="url" id="linkIcon" placeholder="https://example.com/icon.png">
                <small>æ”¯æŒ .icoã€.pngã€.jpgã€.svg æ ¼å¼ï¼Œç•™ç©ºåˆ™è‡ªåŠ¨ä½¿ç”¨ ç½‘ç«™åŸŸå/favicon.ico</small>
              </div>
              <div class="form-group">
                <label>æ ‡ç­¾ï¼ˆç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼‰</label>
                <div style="display: flex; gap: 8px; align-items: flex-start;">
                  <input type="text" id="linkTags" placeholder="ç‰ˆæœ¬æ§åˆ¶,å¼€æº,åä½œ" style="flex: 1;">
                  <button type="button" class="btn btn-secondary" id="showExistingTags" title="é€‰æ‹©å·²æœ‰æ ‡ç­¾">ğŸ·ï¸</button>
                </div>
                <div id="existingTagsPanel" style="display: none; margin-top: 8px; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px;">
                  <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">ç‚¹å‡»æ ‡ç­¾å¿«é€Ÿæ·»åŠ ï¼š</div>
                  <div id="existingTagsList" style="display: flex; flex-wrap: wrap; gap: 5px;"></div>
                </div>
              </div>
              <button type="submit" class="btn btn-primary">ä¿å­˜é“¾æ¥</button>
              <button type="button" class="btn btn-secondary" id="resetLinkForm">é‡ç½®</button>
            </form>
          </div>
          <div class="flex-1">
            <h3 class="section-group-title">ç°æœ‰é“¾æ¥</h3>
            <div class="form-group">
              <select id="linkFilterCategory">
                <option value="">æ˜¾ç¤ºæ‰€æœ‰åˆ†ç±»</option>
              </select>
            </div>
            <div class="data-list" id="linksList"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç½‘ç«™è®¾ç½® -->
    <div class="tab-content" id="settings-tab">
      <div class="data-manager-section">
        <h2>ç½‘ç«™è®¾ç½®</h2>
        <p>è‡ªå®šä¹‰ç½‘ç«™çš„æ ‡é¢˜ã€å›¾æ ‡ã€æè¿°ç­‰åŸºæœ¬ä¿¡æ¯ã€‚</p>
        
        <div class="flex-container">
          <div class="flex-1">
            <form id="settingsForm">
              <h3 class="section-group-title">åŸºæœ¬ä¿¡æ¯</h3>
              <div class="form-group">
                <label>ç½‘ç«™æ ‡é¢˜</label>
                <input type="text" id="siteTitle" placeholder="LinkBoard">
                <small>æ˜¾ç¤ºåœ¨ä¾§è¾¹æ logoä½ç½®</small>
              </div>
              <div class="form-group">
                <label>æµè§ˆå™¨é¡µç­¾æ ‡é¢˜</label>
                <input type="text" id="pageTitle" placeholder="LinkBoard - é“¾æ¥ç®¡ç†é¢æ¿">
                <small>æ˜¾ç¤ºåœ¨æµè§ˆå™¨é¡µç­¾ä¸Š</small>
              </div>
              <div class="form-group">
                <label>ç½‘ç«™æè¿°</label>
                <textarea id="siteDescription" placeholder="ç°ä»£åŒ–çš„æ”¶é›†ä¸ç®¡ç†é“¾æ¥çš„é™æ€ç½‘é¡µæ¡†æ¶"></textarea>
                <small>ç”¨äºSEO metaæè¿°</small>
              </div>
              
              <h3 class="section-group-title">Logoè®¾ç½®</h3>
              <div class="form-group">
                <label>Logoå›¾æ ‡ï¼ˆEmojiï¼‰</label>
                <input type="text" id="logoIcon" placeholder="ğŸ”—" maxlength="2">
                <small>å»ºè®®ä½¿ç”¨å•ä¸ªemoji</small>
              </div>
              <div class="form-group">
                <label>Logoæ–‡å­—</label>
                <input type="text" id="logoText" placeholder="LinkBoard">
              </div>
              <div class="form-group">
                <label>
                  <input type="checkbox" id="showLogoIcon" checked>
                  æ˜¾ç¤ºLogoå›¾æ ‡
                </label>
              </div>
              <div class="form-group">
                <label>
                  <input type="checkbox" id="showLogoText" checked>
                  æ˜¾ç¤ºLogoæ–‡å­—
                </label>
              </div>
              

              
              <h3 class="section-group-title">Dashboardè®¾ç½®</h3>
              <div class="form-group">
                <label>Dashboardæ ‡é¢˜</label>
                <input type="text" id="dashboardTitle" placeholder="Dashboard">
              </div>
              <div class="form-group">
                <label>Dashboardå‰¯æ ‡é¢˜</label>
                <input type="text" id="dashboardSubtitle" placeholder="æ•°æ®ç»Ÿè®¡å’Œç½‘ç«™æ¦‚è§ˆ">
              </div>
              <div class="form-group">
                <label>æ¬¢è¿æ¶ˆæ¯</label>
                <textarea id="welcomeMessage" placeholder="æ¬¢è¿ä½¿ç”¨LinkBoardï¼åœ¨è¿™é‡Œç®¡ç†æ‚¨çš„é“¾æ¥æ”¶è—ã€‚"></textarea>
              </div>
              
              <h3 class="section-group-title">SEOè®¾ç½®</h3>
              <div class="form-group">
                <label>å…³é”®è¯</label>
                <input type="text" id="keywords" placeholder="linkboard, é“¾æ¥ç®¡ç†, ä¹¦ç­¾, å¯¼èˆª">
                <small>ç”¨é€—å·åˆ†éš”</small>
              </div>
              <div class="form-group">
                <label>ä½œè€…</label>
                <input type="text" id="author" placeholder="">
              </div>
              
              <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
              <button type="button" class="btn btn-secondary" id="resetSettingsForm">é‡ç½®</button>
            </form>
          </div>
          
          <div class="flex-1">
            <h3 class="section-group-title">è®¾ç½®é¢„è§ˆ</h3>
            <div class="setting-preview">
              <div class="preview-item">
                <strong>ä¾§è¾¹æ Logo:</strong>
                <div class="logo-preview" id="logoPreview">ğŸ”— LinkBoard</div>
              </div>
              <div class="preview-item">
                <strong>æµè§ˆå™¨é¡µç­¾:</strong>
                <div class="page-title-preview" id="pageTitlePreview">LinkBoard - é“¾æ¥ç®¡ç†é¢æ¿</div>
              </div>
              <div class="preview-item">
                <strong>Dashboardæ ‡é¢˜:</strong>
                <div class="dashboard-preview" id="dashboardPreview">
                  <div class="dash-title">Dashboard</div>
                  <div class="dash-subtitle">æ•°æ®ç»Ÿè®¡å’Œç½‘ç«™æ¦‚è§ˆ</div>
                </div>
              </div>
            </div>
            
            <h3 class="section-group-title">åŠŸèƒ½é…ç½®</h3>
            <div class="form-group">
              <label>
                <input type="checkbox" id="showStats" checked>
                æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
              </label>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="showSearch" checked>
                æ˜¾ç¤ºæœç´¢åŠŸèƒ½
              </label>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="showTags" checked>
                æ˜¾ç¤ºæ ‡ç­¾ç­›é€‰
              </label>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="showCategoryCounts" checked>
                æ˜¾ç¤ºåˆ†ç±»é“¾æ¥è®¡æ•°
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç”Ÿæˆæ–‡ä»¶ -->
    <div class="tab-content" id="export-tab">
      <div class="data-manager-section">
        <h2>ç”Ÿæˆæ–°çš„æ•°æ®æ–‡ä»¶</h2>
        <p>å°†ä¿®æ”¹åçš„æ•°æ®ç”Ÿæˆæ–°çš„ <code>data.js</code> è„šæœ¬å†…å®¹ï¼Œä¸€é”®å¤åˆ¶åæ‰‹åŠ¨æ›¿æ¢é¡¹ç›®ä¸­çš„æ–‡ä»¶ã€‚</p>
        
        <div class="flex-container">
          <div class="flex-1">
            <h3 class="section-group-title">å½“å‰æ•°æ®ç»Ÿè®¡</h3>
            <div id="dataStats"></div>
            
            <h3 class="section-group-title">ç”Ÿæˆé€‰é¡¹</h3>
            <div class="form-group">
              <label>
                <input type="checkbox" id="includeComments" checked>
                åŒ…å«æ³¨é‡Šè¯´æ˜
              </label>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="formatCode" checked>
                æ ¼å¼åŒ–ä»£ç ï¼ˆç¾åŒ–è¾“å‡ºï¼‰
              </label>
            </div>
            
            <button class="btn btn-success" id="copyDataFile">ğŸ“‹ å¤åˆ¶è„šæœ¬å†…å®¹</button>
            <button class="btn btn-primary" id="directEditFile">âœ¨ ä¸€é”®ç¼–è¾‘data.js</button>
          </div>
          
          <div class="flex-1">
            <h3 class="section-group-title">ä½¿ç”¨è¯´æ˜</h3>
            <div style="margin-bottom: 15px;">
              <strong>ğŸ¯ æ™ºèƒ½ä¸€é”®ç¼–è¾‘ (Chrome/Edge)</strong>
              <ul style="margin: 5px 0; padding-left: 20px;">
                <li>ç‚¹å‡»"âœ¨ ä¸€é”®ç¼–è¾‘data.js"æŒ‰é’®</li>
                <li>ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶æ˜¾ç¤ºå½“å‰é¡¹ç›®è·¯å¾„</li>
                <li>ç‚¹å‡»"ğŸ“‹"æŒ‰é’®å¤åˆ¶é¡¹ç›®è·¯å¾„</li>
                <li>é€‰æ‹©"ğŸ’¾ ç»§ç»­ä¿å­˜"æ‰“å¼€æ–‡ä»¶ä¿å­˜å¯¹è¯æ¡†</li>
                <li>åœ¨åœ°å€æ ç²˜è´´è·¯å¾„å¿«é€Ÿè·³è½¬åˆ°é¡¹ç›®æ–‡ä»¶å¤¹</li>
                <li>ç¡®è®¤ä¿å­˜data.jsæ–‡ä»¶ï¼ˆå¯çœ‹åˆ°é¡¹ç›®ä¸­çš„.jsæ–‡ä»¶ï¼‰</li>
                <li>ä¿å­˜ååˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°æ›´æ–°</li>
              </ul>
            </div>
            
            <div style="margin-bottom: 15px;">
              <strong>ğŸ“‹ å¤‡ç”¨æ–¹å¼ï¼šæ‰‹åŠ¨å¤åˆ¶</strong>
              <ul style="margin: 5px 0; padding-left: 20px;">
                <li>ç‚¹å‡»"ğŸ“‹ å¤åˆ¶è„šæœ¬å†…å®¹"æŒ‰é’®</li>
                <li>æ‰‹åŠ¨æ‰“å¼€é¡¹ç›®ä¸­çš„ <code>data.js</code> æ–‡ä»¶</li>
                <li>å…¨é€‰å†…å®¹å¹¶ç²˜è´´æ›¿æ¢</li>
                <li>ä¿å­˜æ–‡ä»¶å¹¶åˆ·æ–°é¡µé¢</li>
              </ul>
            </div>
            
            <div class="status-indicator status-warning">
              <strong>âš ï¸ æ³¨æ„ï¼š</strong>è¯·å…ˆå¤‡ä»½åŸå§‹çš„ data.js æ–‡ä»¶ï¼Œä»¥é˜²æ•°æ®ä¸¢å¤±ï¼
            </div>
            
                         <div class="status-indicator status-success">
               <strong>ğŸš€ æ–°åŠŸèƒ½ï¼š</strong>æ™ºèƒ½è·¯å¾„æ£€æµ‹ï¼Œè‡ªåŠ¨è¯†åˆ«é¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨ç³»ç»Ÿæ–‡ä»¶ä¿å­˜å¯¹è¯æ¡†è®©æ‚¨çœ‹åˆ°é¡¹ç›®ä¸­çš„.jsæ–‡ä»¶ï¼
             </div>
            
            <div class="status-indicator status-success">
              <strong>âœ… å…¼å®¹æ€§ï¼š</strong>æ”¯æŒç°ä»£æµè§ˆå™¨(Chrome 86+/Edge 86+)çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®APIã€‚
            </div>
          </div>
        </div>
        
        <!-- ä»£ç é¢„è§ˆåŒºåŸŸ -->
        <div id="codePreviewContainer">
          <h3 class="section-group-title">ä»£ç é¢„è§ˆ</h3>
          <div class="code-preview" id="codePreview"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ç›´æ¥åŠ è½½å½“å‰æ•°æ® -->
  <script src="data.js"></script>
  <script>
    // ç¦»çº¿æ•°æ®ç®¡ç†å™¨
    class OfflineDataManager {
      constructor() {
        this.currentData = null;
        this.editingCategoryIndex = -1;
        this.editingLinkCategory = null;
        this.editingLinkIndex = -1;
        this.init();
      }

      init() {
        this.loadCurrentData();
        this.setupEventListeners();
        this.renderAll();
        this.updateStatus('æ•°æ®åŠ è½½æˆåŠŸ', 'success');
      }

      loadCurrentData() {
        this.currentData = {
          siteConfig: typeof siteConfig !== 'undefined' ? JSON.parse(JSON.stringify(siteConfig)) : null,
          categories: JSON.parse(JSON.stringify(categories)),
          links: JSON.parse(JSON.stringify(links))
        };
        
        // ç§»é™¤faviconå­—æ®µï¼ˆç°åœ¨æ˜¯ç¡¬ç¼–ç çš„ï¼‰
        if (this.currentData.siteConfig && this.currentData.siteConfig.favicon) {
          delete this.currentData.siteConfig.favicon;
        }
      }

      setupEventListeners() {
        // Tabåˆ‡æ¢
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', () => this.switchTab(btn.dataset.tab));
        });

        // åˆ†ç±»è¡¨å•
        document.getElementById('categoryForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.saveCategory();
        });
        document.getElementById('resetCategoryForm').addEventListener('click', () => {
          this.resetCategoryForm();
        });

        // é“¾æ¥è¡¨å•
        document.getElementById('linkForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.saveLink();
        });
        document.getElementById('resetLinkForm').addEventListener('click', () => {
          this.resetLinkForm();
        });

        // å¤åˆ¶è„šæœ¬å†…å®¹
        document.getElementById('copyDataFile').addEventListener('click', () => {
          this.copyDataFileContent();
        });

        // ä¸€é”®ç¼–è¾‘åŠŸèƒ½
        document.getElementById('directEditFile').addEventListener('click', () => {
          this.directEditFile();
        });

        // é“¾æ¥ç­›é€‰
        document.getElementById('linkFilterCategory').addEventListener('change', () => {
          this.renderLinks();
        });

        // ç½‘ç«™è®¾ç½®
        document.getElementById('settingsForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.saveSettings();
        });
        document.getElementById('resetSettingsForm').addEventListener('click', () => {
          this.resetSettingsForm();
        });

        // è®¾ç½®é¢„è§ˆ
        this.setupSettingsPreview();
        
        // ç”Ÿæˆé€‰é¡¹é¢„è§ˆ
        this.setupExportPreview();
        
        // æ ‡ç­¾åŠŸèƒ½
        document.getElementById('showExistingTags').addEventListener('click', () => {
          this.toggleExistingTagsPanel();
        });
      }
      

      


      switchTab(tabName) {
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(`${tabName}-tab`).classList.add('active');

        if (tabName === 'links') {
          this.updateLinkCategoryOptions();
        } else if (tabName === 'export') {
          this.updateDataStats();
          this.previewGeneratedCode(); // é»˜è®¤æ˜¾ç¤ºé¢„è§ˆ
        } else if (tabName === 'settings') {
          this.loadSettings();
        }
      }

      renderAll() {
        this.renderCategories();
        this.renderLinks();
        this.updateLinkCategoryOptions();
      }

      renderCategories() {
        const container = document.getElementById('categoriesList');
        container.innerHTML = '';

        this.currentData.categories.forEach((category, index) => {
          if (category.id === 'all') return;

          const div = document.createElement('div');
          div.className = 'data-item';
          div.innerHTML = `
            <div class="data-item-info">
              <strong>
                <span class="category-color-block" style="background-color: ${category.color || '#3498db'}"></span>
                ${category.icon} ${category.name}
              </strong><br>
              <small>ID: ${category.id}</small><br>
              <small>${category.description}</small>
            </div>
            <div class="data-item-actions">
              <button class="btn btn-secondary" onclick="dataManager.editCategory(${index})">ç¼–è¾‘</button>
              <button class="btn btn-danger" onclick="dataManager.deleteCategory(${index})">åˆ é™¤</button>
            </div>
          `;
          container.appendChild(div);
        });
      }

      renderLinks() {
        const container = document.getElementById('linksList');
        const filterCategory = document.getElementById('linkFilterCategory').value;
        container.innerHTML = '';

        Object.keys(this.currentData.links).forEach(categoryId => {
          if (categoryId === 'dashboard' || categoryId === 'all') return;
          if (filterCategory && categoryId !== filterCategory) return;

          const categoryData = this.currentData.categories.find(cat => cat.id === categoryId);
          const categoryName = categoryData ? categoryData.name : categoryId;

          this.currentData.links[categoryId].forEach((link, linkIndex) => {
            const div = document.createElement('div');
            div.className = 'data-item';
            div.innerHTML = `
              <div class="data-item-info">
                <strong>${link.title}</strong> <small>(${categoryName})</small><br>
                <small>${link.url}</small><br>
                <small>æ ‡ç­¾: ${link.tags ? link.tags.join(', ') : 'æ— '}</small>
              </div>
              <div class="data-item-actions">
                <button class="btn btn-secondary" onclick="dataManager.editLink('${categoryId}', ${linkIndex})">ç¼–è¾‘</button>
                <button class="btn btn-danger" onclick="dataManager.deleteLink('${categoryId}', ${linkIndex})">åˆ é™¤</button>
              </div>
            `;
            container.appendChild(div);
          });
        });
      }

      updateLinkCategoryOptions() {
        const selects = [
          document.getElementById('linkCategory'),
          document.getElementById('linkFilterCategory')
        ];

        selects.forEach(select => {
          const isFilter = select.id === 'linkFilterCategory';
          const currentValue = select.value;
          
          select.innerHTML = isFilter ? '<option value="">æ˜¾ç¤ºæ‰€æœ‰åˆ†ç±»</option>' : '<option value="">é€‰æ‹©åˆ†ç±»</option>';
          
          this.currentData.categories.forEach(category => {
            if (category.id !== 'all' && category.id !== 'dashboard') {
              const option = document.createElement('option');
              option.value = category.id;
              option.textContent = `${category.icon} ${category.name}`;
              select.appendChild(option);
            }
          });

          if (currentValue) {
            select.value = currentValue;
          }
        });
      }

      // åˆ†ç±»ç®¡ç†
      saveCategory() {
        const category = {
          id: document.getElementById('categoryId').value.trim(),
          name: document.getElementById('categoryName').value.trim(),
          icon: document.getElementById('categoryIcon').value.trim(),
          color: document.getElementById('categoryColor').value,
          description: document.getElementById('categoryDescription').value.trim()
        };

        if (!category.id || !category.name || !category.icon) {
          alert('è¯·å¡«å†™æ‰€æœ‰å¿…éœ€å­—æ®µï¼');
          return;
        }

        if (!/^[a-z0-9-]+$/.test(category.id)) {
          alert('åˆ†ç±»IDåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦ï¼');
          return;
        }

        const existingIndex = this.currentData.categories.findIndex(cat => cat.id === category.id);
        if (existingIndex !== -1 && this.editingCategoryIndex !== existingIndex) {
          alert('åˆ†ç±»IDå·²å­˜åœ¨ï¼');
          return;
        }

        if (this.editingCategoryIndex !== -1) {
          const oldCategoryId = this.currentData.categories[this.editingCategoryIndex].id;
          this.currentData.categories[this.editingCategoryIndex] = category;
          
          if (oldCategoryId !== category.id) {
            this.currentData.links[category.id] = this.currentData.links[oldCategoryId] || [];
            delete this.currentData.links[oldCategoryId];
          }
        } else {
          this.currentData.categories.push(category);
          this.currentData.links[category.id] = [];
        }

        this.resetCategoryForm();
        this.renderAll();
        this.updateStatus('åˆ†ç±»ä¿å­˜æˆåŠŸ', 'success');
      }

      editCategory(index) {
        const category = this.currentData.categories[index];
        this.editingCategoryIndex = index;

        document.getElementById('categoryId').value = category.id;
        document.getElementById('categoryName').value = category.name;
        document.getElementById('categoryIcon').value = category.icon;
        document.getElementById('categoryColor').value = category.color;
        document.getElementById('categoryDescription').value = category.description;
      }

      deleteCategory(index) {
        const category = this.currentData.categories[index];
        if (!confirm(`ç¡®å®šè¦åˆ é™¤åˆ†ç±»"${category.name}"å—ï¼Ÿè¿™ä¹Ÿä¼šåˆ é™¤è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰é“¾æ¥ï¼`)) {
          return;
        }

        this.currentData.categories.splice(index, 1);
        delete this.currentData.links[category.id];

        this.renderAll();
        this.updateStatus('åˆ†ç±»åˆ é™¤æˆåŠŸ', 'success');
      }

      resetCategoryForm() {
        document.getElementById('categoryForm').reset();
        document.getElementById('categoryColor').value = '#3498db';
        this.editingCategoryIndex = -1;
      }

      // é“¾æ¥ç®¡ç†
      saveLink() {
        const categoryId = document.getElementById('linkCategory').value;
        let iconValue = document.getElementById('linkIcon').value.trim();
        const linkUrl = document.getElementById('linkUrl').value.trim();
        
        // å¦‚æœå›¾æ ‡URLä¸ºç©ºï¼Œæ ¹æ®é“¾æ¥URLç”Ÿæˆé»˜è®¤çš„favicon.icoè·¯å¾„
        if (!iconValue && linkUrl) {
          try {
            const url = new URL(linkUrl);
            iconValue = `${url.protocol}//${url.host}/favicon.ico`;
          } catch (e) {
            iconValue = 'favicon.ico'; // å¦‚æœURLè§£æå¤±è´¥ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„
          }
        }
        
        const link = {
          title: document.getElementById('linkTitle').value.trim(),
          url: document.getElementById('linkUrl').value.trim(),
          description: document.getElementById('linkDescription').value.trim(),
          icon: iconValue,
          tags: document.getElementById('linkTags').value.split(',').map(tag => tag.trim()).filter(tag => tag)
        };

        if (!categoryId || !link.title || !link.url) {
          alert('è¯·å¡«å†™æ‰€æœ‰å¿…éœ€å­—æ®µï¼');
          return;
        }

        if (!this.currentData.links[categoryId]) {
          this.currentData.links[categoryId] = [];
        }

        if (this.editingLinkIndex !== -1 && this.editingLinkCategory === categoryId) {
          this.currentData.links[categoryId][this.editingLinkIndex] = link;
        } else if (this.editingLinkIndex !== -1) {
          this.currentData.links[this.editingLinkCategory].splice(this.editingLinkIndex, 1);
          this.currentData.links[categoryId].push(link);
        } else {
          this.currentData.links[categoryId].push(link);
        }

        this.resetLinkForm();
        this.renderLinks();
        this.updateStatus('é“¾æ¥ä¿å­˜æˆåŠŸ', 'success');
      }

      editLink(categoryId, linkIndex) {
        const link = this.currentData.links[categoryId][linkIndex];
        this.editingLinkCategory = categoryId;
        this.editingLinkIndex = linkIndex;

        document.getElementById('linkCategory').value = categoryId;
        document.getElementById('linkTitle').value = link.title;
        document.getElementById('linkUrl').value = link.url;
        document.getElementById('linkDescription').value = link.description || '';
        document.getElementById('linkTags').value = link.tags ? link.tags.join(', ') : '';
        
        // è®¾ç½®å›¾æ ‡URLï¼Œå¦‚æœæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„favicon.icoåˆ™æ˜¾ç¤ºä¸ºç©º
        let iconValue = link.icon || '';
        if (iconValue && iconValue.endsWith('/favicon.ico')) {
          // æ£€æŸ¥æ˜¯å¦æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„favicon.icoè·¯å¾„ï¼Œå¦‚æœæ˜¯åˆ™æ˜¾ç¤ºä¸ºç©ºè®©ç”¨æˆ·çŸ¥é“æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„
          try {
            const linkUrl = new URL(link.url);
            const expectedFavicon = `${linkUrl.protocol}//${linkUrl.host}/favicon.ico`;
            if (iconValue === expectedFavicon) {
              iconValue = ''; // å¦‚æœåŒ¹é…è‡ªåŠ¨ç”Ÿæˆçš„è·¯å¾„ï¼Œæ˜¾ç¤ºä¸ºç©º
            }
          } catch (e) {
            // URLè§£æå¤±è´¥ï¼Œä¿æŒåŸå€¼
          }
        }
        document.getElementById('linkIcon').value = iconValue;

        this.switchTab('links');
      }

      deleteLink(categoryId, linkIndex) {
        if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé“¾æ¥å—ï¼Ÿ')) {
          return;
        }

        this.currentData.links[categoryId].splice(linkIndex, 1);
        this.renderLinks();
        this.updateStatus('é“¾æ¥åˆ é™¤æˆåŠŸ', 'success');
      }

      resetLinkForm() {
        document.getElementById('linkForm').reset();
        this.editingLinkCategory = null;
        this.editingLinkIndex = -1;
      }

      // ç”Ÿæˆæ–‡ä»¶
      updateDataStats() {
        const totalCategories = this.currentData.categories.filter(cat => cat.id !== 'all').length;
        let totalLinks = 0;
        
        Object.keys(this.currentData.links).forEach(categoryId => {
          if (categoryId !== 'dashboard' && categoryId !== 'all') {
            totalLinks += this.currentData.links[categoryId].length;
          }
        });

        document.getElementById('dataStats').innerHTML = `
          <p><strong>åˆ†ç±»æ•°é‡ï¼š</strong>${totalCategories}</p>
          <p><strong>é“¾æ¥æ€»æ•°ï¼š</strong>${totalLinks}</p>
          <p><strong>æœ€åä¿®æ”¹ï¼š</strong>${new Date().toLocaleString()}</p>
        `;
      }

      // ç½‘ç«™è®¾ç½®ç›¸å…³æ–¹æ³•
      loadSettings() {
        if (typeof siteConfig !== 'undefined') {
          // åŸºæœ¬ä¿¡æ¯
          document.getElementById('siteTitle').value = siteConfig.title || '';
          document.getElementById('pageTitle').value = siteConfig.pageTitle || '';
          document.getElementById('siteDescription').value = siteConfig.description || '';
          
          // Logoè®¾ç½®
          if (siteConfig.logo) {
            document.getElementById('logoIcon').value = siteConfig.logo.icon || '';
            document.getElementById('logoText').value = siteConfig.logo.text || '';
            document.getElementById('showLogoIcon').checked = siteConfig.logo.showIcon !== false;
            document.getElementById('showLogoText').checked = siteConfig.logo.showText !== false;
          }
          

          
          // Dashboardè®¾ç½®
          if (siteConfig.dashboard) {
            document.getElementById('dashboardTitle').value = siteConfig.dashboard.title || '';
            document.getElementById('dashboardSubtitle').value = siteConfig.dashboard.subtitle || '';
            document.getElementById('welcomeMessage').value = siteConfig.dashboard.welcomeMessage || '';
          }
          
          // SEOè®¾ç½®
          if (siteConfig.meta) {
            document.getElementById('keywords').value = siteConfig.meta.keywords || '';
            document.getElementById('author').value = siteConfig.meta.author || '';
          }
          
          // åŠŸèƒ½é…ç½®
          if (siteConfig.features) {
            document.getElementById('showStats').checked = siteConfig.features.showStats !== false;
            document.getElementById('showSearch').checked = siteConfig.features.showSearch !== false;
            document.getElementById('showTags').checked = siteConfig.features.showTags !== false;
            document.getElementById('showCategoryCounts').checked = siteConfig.features.showCategoryCounts !== false;
          }
          
          this.updateSettingsPreview();
        }
      }
      
      saveSettings() {
        // æ”¶é›†è¡¨å•æ•°æ®
        const settings = {
          title: document.getElementById('siteTitle').value.trim(),
          subtitle: document.getElementById('pageTitle').value.trim(),
          description: document.getElementById('siteDescription').value.trim(),
          pageTitle: document.getElementById('pageTitle').value.trim(),
          
          logo: {
            text: document.getElementById('logoText').value.trim(),
            icon: document.getElementById('logoIcon').value.trim(),
            showIcon: document.getElementById('showLogoIcon').checked,
            showText: document.getElementById('showLogoText').checked
          },
          
          dashboard: {
            title: document.getElementById('dashboardTitle').value.trim(),
            subtitle: document.getElementById('dashboardSubtitle').value.trim(),
            welcomeMessage: document.getElementById('welcomeMessage').value.trim()
          },
          
          meta: {
            keywords: document.getElementById('keywords').value.trim(),
            author: document.getElementById('author').value.trim(),
            language: 'zh-CN'
          },
          
          features: {
            showStats: document.getElementById('showStats').checked,
            showSearch: document.getElementById('showSearch').checked,
            showTags: document.getElementById('showTags').checked,
            showCategoryCounts: document.getElementById('showCategoryCounts').checked
          },
          
          theme: {
            primaryColor: '#3498db',
            accentColor: '#2ecc71',
            darkMode: false
          },
          
          footer: {
            copyright: 'Â© 2024 LinkBoard. All rights reserved.',
            showCopyright: false,
            links: []
          }
        };
        
        // æ›´æ–°å½“å‰æ•°æ®
        this.currentData.siteConfig = settings;
        
        this.updateSettingsPreview();
        this.updateStatus('ç½‘ç«™è®¾ç½®ä¿å­˜æˆåŠŸ', 'success');
      }
      
      resetSettingsForm() {
        // é‡ç½®ä¸ºé»˜è®¤å€¼
        document.getElementById('siteTitle').value = 'LinkBoard';
        document.getElementById('pageTitle').value = 'LinkBoard - é“¾æ¥ç®¡ç†é¢æ¿';
        document.getElementById('siteDescription').value = 'ç°ä»£åŒ–çš„æ”¶é›†ä¸ç®¡ç†é“¾æ¥çš„é™æ€ç½‘é¡µæ¡†æ¶';
        document.getElementById('logoIcon').value = 'ğŸ”—';
        document.getElementById('logoText').value = 'LinkBoard';
        document.getElementById('showLogoIcon').checked = true;
        document.getElementById('showLogoText').checked = true;
        document.getElementById('dashboardTitle').value = 'Dashboard';
        document.getElementById('dashboardSubtitle').value = 'æ•°æ®ç»Ÿè®¡å’Œç½‘ç«™æ¦‚è§ˆ';
        document.getElementById('welcomeMessage').value = 'æ¬¢è¿ä½¿ç”¨LinkBoardï¼åœ¨è¿™é‡Œç®¡ç†æ‚¨çš„é“¾æ¥æ”¶è—ã€‚';
        document.getElementById('keywords').value = 'linkboard, é“¾æ¥ç®¡ç†, ä¹¦ç­¾, å¯¼èˆª, æ”¶è—å¤¹';
        document.getElementById('author').value = '';
        document.getElementById('showStats').checked = true;
        document.getElementById('showSearch').checked = true;
        document.getElementById('showTags').checked = true;
        document.getElementById('showCategoryCounts').checked = true;
        
        this.updateSettingsPreview();
      }
      
      setupSettingsPreview() {
        // ä¸ºæ‰€æœ‰è®¾ç½®è¾“å…¥æ¡†æ·»åŠ å®æ—¶é¢„è§ˆ
        const inputs = [
          'siteTitle', 'pageTitle', 'logoIcon', 'logoText', 
          'showLogoIcon', 'showLogoText', 'dashboardTitle', 'dashboardSubtitle'
        ];
        
        inputs.forEach(inputId => {
          const element = document.getElementById(inputId);
          if (element) {
            element.addEventListener('input', () => this.updateSettingsPreview());
            element.addEventListener('change', () => this.updateSettingsPreview());
          }
        });
      }
      
      updateSettingsPreview() {
        // æ›´æ–°Logoé¢„è§ˆ
        const logoIcon = document.getElementById('logoIcon').value || 'ğŸ”—';
        const logoText = document.getElementById('logoText').value || 'LinkBoard';
        const showIcon = document.getElementById('showLogoIcon').checked;
        const showText = document.getElementById('showLogoText').checked;
        
        let logoContent = '';
        if (showIcon) logoContent += logoIcon + ' ';
        if (showText) logoContent += logoText;
        
        document.getElementById('logoPreview').textContent = logoContent || 'LinkBoard';
        
        // æ›´æ–°é¡µé¢æ ‡é¢˜é¢„è§ˆ
        const pageTitle = document.getElementById('pageTitle').value || 'LinkBoard - é“¾æ¥ç®¡ç†é¢æ¿';
        document.getElementById('pageTitlePreview').textContent = pageTitle;
        
        // æ›´æ–°Dashboardé¢„è§ˆ
        const dashTitle = document.getElementById('dashboardTitle').value || 'Dashboard';
        const dashSubtitle = document.getElementById('dashboardSubtitle').value || 'æ•°æ®ç»Ÿè®¡å’Œç½‘ç«™æ¦‚è§ˆ';
        
        document.querySelector('.dash-title').textContent = dashTitle;
        document.querySelector('.dash-subtitle').textContent = dashSubtitle;
      }
      
      setupExportPreview() {
        // ä¸ºç”Ÿæˆé€‰é¡¹æ·»åŠ å®æ—¶é¢„è§ˆ
        const exportOptions = ['includeComments', 'formatCode'];
        
        exportOptions.forEach(optionId => {
          const element = document.getElementById(optionId);
          if (element) {
            element.addEventListener('change', () => {
              // å¦‚æœå½“å‰åœ¨exportæ ‡ç­¾é¡µï¼Œæ›´æ–°é¢„è§ˆ
              const exportTab = document.getElementById('export-tab');
              if (exportTab && exportTab.classList.contains('active')) {
                this.previewGeneratedCode();
              }
            });
          }
        });
      }

      // å°†JavaScriptå¯¹è±¡è½¬æ¢ä¸ºæ­£ç¡®çš„JavaScriptä»£ç æ ¼å¼
      objectToJavaScript(obj, indent = 0) {
        const spaces = '  '.repeat(indent);
        const nextSpaces = '  '.repeat(indent + 1);
        
        if (obj === null) return 'null';
        if (obj === undefined) return 'undefined';
        if (typeof obj === 'string') return `'${obj.replace(/'/g, "\\'")}'`;
        if (typeof obj === 'number' || typeof obj === 'boolean') return obj.toString();
        
        if (Array.isArray(obj)) {
          if (obj.length === 0) return '[]';
          if (obj.every(item => typeof item === 'string')) {
            // ç®€åŒ–å­—ç¬¦ä¸²æ•°ç»„çš„æ ¼å¼ï¼Œæ”¾åœ¨ä¸€è¡Œ
            return `[${obj.map(item => `'${item.replace(/'/g, "\\'")}'`).join(', ')}]`;
          }
          return `[\n${obj.map(item => nextSpaces + this.objectToJavaScript(item, indent + 1)).join(',\n')}\n${spaces}]`;
        }
        
        if (typeof obj === 'object') {
          const keys = Object.keys(obj);
          if (keys.length === 0) return '{}';
          
          const items = keys.map(key => {
            const value = this.objectToJavaScript(obj[key], indent + 1);
            return `${nextSpaces}'${key}': ${value}`;
          });
          
          return `{\n${items.join(',\n')}\n${spaces}}`;
        }
        
        return String(obj);
      }

      generateDataFileContent() {
        const includeComments = document.getElementById('includeComments').checked;
        const formatCode = document.getElementById('formatCode').checked;

        let content = '';
        
        if (includeComments) {
          content += `// ç½‘ç«™é…ç½®æ•°æ®\n// è‡ªåŠ¨ç”Ÿæˆäº ${new Date().toLocaleString()}\n`;
        }
        
        // ç”ŸæˆsiteConfigï¼ˆæ’é™¤faviconå­—æ®µï¼Œå› ä¸ºå®ƒç°åœ¨æ˜¯ç¡¬ç¼–ç çš„ï¼‰
        if (this.currentData.siteConfig) {
          const siteConfigCopy = { ...this.currentData.siteConfig };
          delete siteConfigCopy.favicon; // ç§»é™¤faviconå­—æ®µ
          
          content += 'const siteConfig = ';
          if (formatCode) {
            content += this.objectToJavaScript(siteConfigCopy);
          } else {
            content += this.objectToJavaScript(siteConfigCopy).replace(/\s+/g, ' ').replace(/,\s*}/g, '}');
          }
          content += ';\n\n';
        }
        
        if (includeComments) {
          content += `// åˆ†ç±»æ•°æ®\n`;
        }
        
        content += 'const categories = ';
        if (formatCode) {
          content += this.objectToJavaScript(this.currentData.categories);
        } else {
          content += this.objectToJavaScript(this.currentData.categories).replace(/\s+/g, ' ').replace(/,\s*}/g, '}');
        }
        content += ';\n\n';

        if (includeComments) {
          content += '// é“¾æ¥æ•°æ®\n';
        }
        
        content += 'const links = ';
        if (formatCode) {
          content += this.objectToJavaScript(this.currentData.links);
        } else {
          content += this.objectToJavaScript(this.currentData.links).replace(/\s+/g, ' ').replace(/,\s*}/g, '}');
        }
        content += ';';

        return content;
      }

      previewGeneratedCode() {
        const code = this.generateDataFileContent();
        const previewElement = document.getElementById('codePreview');
        previewElement.textContent = code;
      }

      async copyDataFileContent() {
        const content = this.generateDataFileContent();
        
        try {
          await navigator.clipboard.writeText(content);
          this.updateStatus('è„šæœ¬å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼å¯ç›´æ¥ç²˜è´´åˆ° data.js æ–‡ä»¶ä¸­', 'success');
        } catch (err) {
          // é™çº§æ–¹æ¡ˆï¼šåˆ›å»ºä¸€ä¸ªæ–‡æœ¬åŸŸå¹¶é€‰ä¸­å¤åˆ¶
          const textArea = document.createElement('textarea');
          textArea.value = content;
          textArea.style.position = 'fixed';
          textArea.style.left = '-999999px';
          textArea.style.top = '-999999px';
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();
          
          try {
            document.execCommand('copy');
            this.updateStatus('è„šæœ¬å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼å¯ç›´æ¥ç²˜è´´åˆ° data.js æ–‡ä»¶ä¸­', 'success');
          } catch (copyErr) {
            this.updateStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é¢„è§ˆä»£ç ', 'error');
          }
          
          document.body.removeChild(textArea);
        }
      }

      // è·å–å½“å‰é¡¹ç›®çš„åŸºç¡€è·¯å¾„
      getCurrentProjectPath() {
        const currentUrl = window.location.href;
        const currentPath = window.location.pathname;
        
        // å¯¹äº file:// åè®®ï¼Œä»URLä¸­æå–ç›®å½•è·¯å¾„
        if (currentUrl.startsWith('file://')) {
          // ç§»é™¤æ–‡ä»¶åï¼Œè·å–ç›®å½•è·¯å¾„
          const dirPath = currentUrl.substring(0, currentUrl.lastIndexOf('/'));
          return {
            fullPath: dirPath,
            displayPath: decodeURIComponent(dirPath),
            isFileProtocol: true
          };
        } else {
          // å¯¹äº http/https åè®®
          const basePath = currentPath.substring(0, currentPath.lastIndexOf('/'));
          return {
            fullPath: window.location.origin + basePath,
            displayPath: basePath,
            isFileProtocol: false
          };
        }
      }

            // å¢å¼ºçš„ä¸€é”®ç¼–è¾‘åŠŸèƒ½ - æ™ºèƒ½è·¯å¾„æ£€æµ‹
      async directEditFile() {
        try {
          // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
          if (!('showSaveFilePicker' in window)) {
            this.updateStatus('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿè®¿é—®APIï¼Œè¯·ä½¿ç”¨Chrome 86+æˆ–Edge 86+', 'warning');
            return;
          }
          
          const content = this.generateDataFileContent();
          const projectPath = this.getCurrentProjectPath();
          
          // æ˜¾ç¤ºè·¯å¾„æ£€æµ‹å’Œæ“ä½œæŒ‡å¼•
          const shouldProceed = await this.showPathGuideModal(projectPath.displayPath);
          
          if (!shouldProceed) {
            this.updateStatus('æ“ä½œå·²å–æ¶ˆ', 'warning');
            return;
          }
          
          // æ˜¾ç¤ºå½“å‰æ£€æµ‹åˆ°çš„é¡¹ç›®è·¯å¾„æç¤º
          this.updateStatus(`ğŸ’¡ è¯·åœ¨æ–‡ä»¶ä¿å­˜å¯¹è¯æ¡†ä¸­å¯¼èˆªåˆ°: ${projectPath.displayPath}`, 'warning');
          
          // ä½¿ç”¨ç³»ç»Ÿæ–‡ä»¶ä¿å­˜å¯¹è¯æ¡†
          const fileHandle = await window.showSaveFilePicker({
            suggestedName: 'data.js',
            types: [{
              description: 'JavaScript files',
              accept: { 'text/javascript': ['.js'] }
            }]
          });
          
          // åˆ›å»ºå¯å†™æµå¹¶å†™å…¥å†…å®¹
          const writable = await fileHandle.createWritable();
          await writable.write(content);
          await writable.close();
          
          // è·å–æ–‡ä»¶ä¿¡æ¯ç”¨äºç¡®è®¤
          let fileInfo = '';
          try {
            const file = await fileHandle.getFile();
            fileInfo = ` (å¤§å°: ${(file.size / 1024).toFixed(1)}KB, ä¿®æ”¹æ—¶é—´: ${new Date(file.lastModified).toLocaleString()})`;
          } catch (e) {
            // å¿½ç•¥è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥çš„é”™è¯¯
          }
          
          this.updateStatus(`ğŸ‰ data.jsæ–‡ä»¶å·²ä¿å­˜æˆåŠŸï¼${fileInfo} åˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°æ›´æ–°`, 'success');
          
          // æä¾›åˆ·æ–°é¡µé¢çš„é€‰é¡¹
          setTimeout(() => {
            if (confirm('æ•°æ®å·²ä¿å­˜ï¼Œæ˜¯å¦ç«‹å³åˆ·æ–°é¡µé¢æŸ¥çœ‹æ›´æ–°ï¼Ÿ')) {
              window.location.reload();
            }
          }, 1000);
          
        } catch (err) {
          if (err.name === 'AbortError') {
            this.updateStatus('æ“ä½œå·²å–æ¶ˆ', 'warning');
          } else {
            console.error('æ–‡ä»¶ä¿å­˜å¤±è´¥:', err);
            this.updateStatus('æ–‡ä»¶ä¿å­˜å¤±è´¥ï¼Œè¯·å°è¯•å…¶ä»–æ–¹å¼', 'error');
          }
        }
      }

      // å¤åˆ¶è·¯å¾„åˆ°å‰ªè´´æ¿
      async copyPathToClipboard(path) {
        try {
          // è½¬æ¢ä¸ºWindowsè·¯å¾„æ ¼å¼
          const windowsPath = path.replace('file:///', '').replace(/\//g, '\\');
          await navigator.clipboard.writeText(windowsPath);
          return true;
        } catch (err) {
          console.error('å¤åˆ¶è·¯å¾„å¤±è´¥:', err);
          return false;
        }
      }

      // æ˜¾ç¤ºè·¯å¾„æŒ‡å¯¼æ¨¡æ€æ¡†
      async showPathGuideModal(projectPath) {
        return new Promise((resolve) => {
          const modal = document.createElement('div');
          modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            font-family: inherit;
          `;
          
          // è½¬æ¢è·¯å¾„ä¸ºWindowsæ ¼å¼æ˜¾ç¤º
          const windowsPath = projectPath.replace('file:///', '').replace(/\//g, '\\');
          
          modal.innerHTML = `
            <div style="
              background: var(--card-bg, #fff);
              padding: 30px;
              border-radius: 12px;
              max-width: 600px;
              text-align: left;
              box-shadow: 0 10px 30px rgba(0,0,0,0.3);
              color: var(--text-primary, #333);
            ">
              <h3 style="margin-top: 0; color: var(--primary-color, #3498db); text-align: center;">ğŸ¯ æ™ºèƒ½è·¯å¾„æŒ‡å¼•</h3>
              
              <div style="
                background: var(--bg-secondary, #f8f9fa);
                padding: 15px;
                border-radius: 8px;
                margin: 15px 0;
                border: 1px solid var(--border-color, #ddd);
              ">
                <div style="font-weight: bold; margin-bottom: 8px;">ğŸ“ æ£€æµ‹åˆ°çš„é¡¹ç›®è·¯å¾„ï¼š</div>
                <div style="
                  font-family: monospace;
                  font-size: 12px;
                  word-break: break-all;
                  background: white;
                  padding: 8px;
                  border-radius: 4px;
                  border: 1px solid #ddd;
                  display: flex;
                  align-items: center;
                  gap: 8px;
                ">${windowsPath}<button id="copyPath" style="
                  padding: 4px 8px;
                  background: var(--primary-color, #3498db);
                  color: white;
                  border: none;
                  border-radius: 4px;
                  cursor: pointer;
                  font-size: 10px;
                  flex-shrink: 0;
                " title="å¤åˆ¶è·¯å¾„">ğŸ“‹</button></div>
              </div>
              
                             <div style="
                 background: #e8f5e8;
                 padding: 15px;
                 border-radius: 8px;
                 margin: 15px 0;
                 border: 1px solid #c3e6cb;
                 color: #155724;
               ">
                 <div style="font-weight: bold; margin-bottom: 8px;">ğŸ’¾ æ–‡ä»¶ä¿å­˜è¯´æ˜ï¼š</div>
                 <div style="font-size: 14px;">ç³»ç»Ÿå°†æ‰“å¼€æ–‡ä»¶ä¿å­˜å¯¹è¯æ¡†ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸­çš„.jsæ–‡ä»¶ï¼Œç¡®è®¤ä¿å­˜ä½ç½®åæ›¿æ¢åŸæœ‰æ–‡ä»¶ã€‚</div>
               </div>
               
               <div style="margin: 20px 0;">
                 <div style="font-weight: bold; margin-bottom: 10px;">ğŸ“ æ“ä½œæ­¥éª¤ï¼š</div>
                 <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                   <li>ç‚¹å‡»ä¸Šæ–¹"ğŸ“‹"æŒ‰é’®å¤åˆ¶é¡¹ç›®è·¯å¾„</li>
                   <li>ç‚¹å‡»"ç»§ç»­ä¿å­˜"æ‰“å¼€æ–‡ä»¶ä¿å­˜å¯¹è¯æ¡†</li>
                   <li>åœ¨åœ°å€æ ç²˜è´´è·¯å¾„å¹¶å›è½¦ï¼Œå¿«é€Ÿè·³è½¬åˆ°é¡¹ç›®æ–‡ä»¶å¤¹</li>
                   <li>é€‰æ‹©æˆ–è¾“å…¥"data.js"æ–‡ä»¶åï¼Œç¡®è®¤ä¿å­˜</li>
                 </ol>
               </div>
               
               <div style="text-align: center; margin-top: 25px;">
                 <button id="continueOperation" style="
                   padding: 15px 30px;
                   background: var(--primary-color, #3498db);
                   color: white;
                   border: none;
                   border-radius: 8px;
                   cursor: pointer;
                   font-size: 16px;
                   margin-right: 15px;
                   font-weight: bold;
                   box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
                 ">ğŸ’¾ ç»§ç»­ä¿å­˜</button>
                 <button id="cancelOperation" style="
                   padding: 15px 30px;
                   background: #e74c3c;
                   color: white;
                   border: none;
                   border-radius: 8px;
                   cursor: pointer;
                   font-size: 16px;
                   font-weight: bold;
                   box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
                 ">âŒ å–æ¶ˆ</button>
               </div>
              
              <div style="
                font-size: 12px;
                color: var(--text-secondary, #666);
                margin-top: 15px;
                text-align: center;
                padding: 10px;
                background: var(--bg-secondary, #f8f9fa);
                border-radius: 6px;
              ">
                ğŸ’¡ å°è´´å£«ï¼šç¬¬ä¸€æ¬¡é€‰æ‹©æ–‡ä»¶å¤¹åï¼Œæµè§ˆå™¨ä¼šè®°ä½ä½ç½®ï¼Œåç»­æ“ä½œä¼šæ›´æ–¹ä¾¿
              </div>
            </div>
          `;
          
          document.body.appendChild(modal);
          
          // å¤åˆ¶è·¯å¾„åŠŸèƒ½
          document.getElementById('copyPath').onclick = async () => {
            const success = await this.copyPathToClipboard(projectPath);
            const btn = document.getElementById('copyPath');
            if (success) {
              btn.textContent = 'âœ…';
              btn.style.background = '#27ae60';
              setTimeout(() => {
                btn.textContent = 'ğŸ“‹';
                btn.style.background = 'var(--primary-color, #3498db)';
              }, 2000);
            } else {
              btn.textContent = 'âŒ';
              btn.style.background = '#e74c3c';
              setTimeout(() => {
                btn.textContent = 'ğŸ“‹';
                btn.style.background = 'var(--primary-color, #3498db)';
              }, 2000);
            }
          };
          
                     document.getElementById('continueOperation').onclick = () => {
             document.body.removeChild(modal);
             resolve(true);
           };
           
           document.getElementById('cancelOperation').onclick = () => {
             document.body.removeChild(modal);
             resolve(false); // è¿”å›falseè¡¨ç¤ºå–æ¶ˆæ“ä½œ
           };
          
                     // ç‚¹å‡»èƒŒæ™¯å…³é—­
           modal.onclick = (e) => {
             if (e.target === modal) {
               document.body.removeChild(modal);
               resolve(false);
             }
           };
        });
      }

      // æ ‡ç­¾åŠŸèƒ½ç›¸å…³æ–¹æ³•
      getAllExistingTags() {
        const tags = new Set();
        
        Object.keys(this.currentData.links).forEach(categoryId => {
          if (categoryId === 'dashboard' || categoryId === 'all') return;
          
          this.currentData.links[categoryId].forEach(link => {
            if (link.tags && Array.isArray(link.tags)) {
              link.tags.forEach(tag => {
                if (tag.trim()) {
                  tags.add(tag.trim());
                }
              });
            }
          });
        });
        
        return Array.from(tags).sort();
      }
      
      toggleExistingTagsPanel() {
        const panel = document.getElementById('existingTagsPanel');
        const isVisible = panel.style.display !== 'none';
        
        if (isVisible) {
          panel.style.display = 'none';
        } else {
          this.renderExistingTags();
          panel.style.display = 'block';
        }
      }
      
      renderExistingTags() {
        const container = document.getElementById('existingTagsList');
        const existingTags = this.getAllExistingTags();
        
        container.innerHTML = '';
        
        if (existingTags.length === 0) {
          container.innerHTML = '<div style="color: var(--text-secondary); font-size: 12px;">æš‚æ— å·²æœ‰æ ‡ç­¾</div>';
          return;
        }
        
        existingTags.forEach(tag => {
          const tagButton = document.createElement('button');
          tagButton.className = 'tag-item';
          tagButton.textContent = tag;
          tagButton.type = 'button';
          tagButton.addEventListener('click', () => {
            this.addTagToInput(tag, tagButton);
          });
          
          container.appendChild(tagButton);
        });
      }
      
      addTagToInput(tag, buttonElement) {
        const tagsInput = document.getElementById('linkTags');
        const currentTags = tagsInput.value.split(',').map(t => t.trim()).filter(t => t);
        
        // æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å·²å­˜åœ¨
        if (currentTags.includes(tag)) {
          // æ ‡ç­¾å·²å­˜åœ¨ï¼Œç»™å‡ºè§†è§‰åé¦ˆ
          buttonElement.classList.add('added');
          setTimeout(() => {
            buttonElement.classList.remove('added');
          }, 1000);
          this.updateStatus(`æ ‡ç­¾"${tag}"å·²å­˜åœ¨`, 'warning');
          return;
        }
        
        // æ·»åŠ æ ‡ç­¾
        currentTags.push(tag);
        tagsInput.value = currentTags.join(', ');
        
        // ç»™å‡ºæˆåŠŸåé¦ˆ
        buttonElement.classList.add('added');
        setTimeout(() => {
          buttonElement.classList.remove('added');
        }, 1000);
        
        this.updateStatus(`å·²æ·»åŠ æ ‡ç­¾"${tag}"`, 'success');
      }

      updateStatus(message, type) {
        const indicator = document.getElementById('statusIndicator');
        indicator.textContent = message;
        indicator.className = `status-indicator status-${type}`;
        
        if (type === 'success') {
          setTimeout(() => {
            indicator.textContent = 'ç³»ç»Ÿå°±ç»ª - å½“å‰ä½¿ç”¨ç¦»çº¿æ¨¡å¼';
            indicator.className = 'status-indicator status-success';
          }, 3000);
        }
      }
    }

    // åˆå§‹åŒ–
    let dataManager;
    document.addEventListener('DOMContentLoaded', () => {
      dataManager = new OfflineDataManager();
    });
  </script>
</body>
</html> 